<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>index</title>
<style>
	.container{
	 	padding: 30px; 
	 	width:700px; 
	 }
	h1{
		text-align: center;
		margin-bottom: 50px
	}
	table{
		border-collapse: collapse;
	}
	h3{
		font-weight : normal;
		font-size: 15px;
	}
	th,td{
		padding: 10px;
		border: 1px solid black;
	}
	input{
		border:none;
		width:80px;
		font-size: 15px;
	}
	.company-info{
		float: right;	
	}
	.estimate-info{
		margin-top: 50px;
		clear: both;
		margin-bottom: 50px;
	}
	.num{
		width:50px;
	}
	.lineItem{
		width: 100px
	}
	.price{
		width: 80px;
	}
	.note{
		width: 140px;
		
	}
	.btnPrint{
		margin-top: 20px;
	}
	/* 견적시 밑줄 */
	u {
	   text-decoration : none;
	   border-bottom : 4px double black;
	   padding-bottom : 5px;
	}
	@media print{
		.btnPrint{
			display:none;
		}
	}
	.tableSmlTitle{
		background-color: #E6E6E6;
	}
	/* 인쇄시 색 출력 */
	.tableSmlTitle{ 
		-webkit-print-color-adjust:exact; 
	}

</style>
<!-- jQuery -->
<script src="../../plugins/jquery/jquery.min.js"></script>
<script type="text/javascript" th:inline="javascript">
	$(function(){
		/*<![CDATA[*/
		var eList = /*[[ ${eList} ]]*/;
		var page = /*[[ ${page} ]]*/;
		var remainClmn = /*[[ ${remainClmn} ]]*/;
		/*]]*/
		console.log(eList);

		var html = "";
		html += "<table class='estimate-info'>	\
					<tr class='tableSmlTitle'>\
						<th colspan='2'>합계금액</th>\
						<th colspan='3' rowspan='2'>금<span id='totalKor'></span>원정</th>\
						<th colspan='2' rowspan='2'>(\\<span id='totalNum'></span>)</th>\
					</tr>\
					<tr class='tableSmlTitle'>\
						<th colspan='2'>(공급가액+세액)</th>\
					</tr>"
		html+="<tr class='tableSmlTitle'>\
			<th class='num'>번호</th>\
			<th class='lineItem'>품목명</th>\
			<th class='num'>수량</th>\
			<th class='price'>단가</th>\
			<th class='price'>공급가액</th>\
			<th class='price'>세액</th>\
			<th class='note'>비고</th>\
		</tr>"
		var i=0
		for(i; i<eList.length; i++){
			if(i%10==0 && i!=0){
				html+="</table>";
				html+="<table class='estimate-info' style='page-break-before:always'>"
				html+="<tr class='tableSmlTitle'>\
						<th class='num'>번호</th>\
						<th class='lineItem'>품목명</th>\
						<th class='num'>수량</th>\
						<th class='price'>단가</th>\
						<th class='price'>공급가액</th>\
						<th class='price'>세액</th>\
						<th class='note'>비고</th>\
					</tr>"
			}
				html += "<tr>"
				if(eList[i].estimateNo!=null){
					html += "<td>"+eList[i].estimateNo+"</td>";
				}else{
					html += "<td></td>";
				}
				if(eList[i].setCode!=null){
					html += "<td>"+eList[i].setName+"</td>";
					html += "<td>"+eList[i].tradingCount+"</td>"
					html += "<td class='priceNum'>"+eList[i].setDayPrice*0.9+"</td>";
					html += "<td class='priceNum suppliedValue'>"+(eList[i].tradingCount*eList[i].setDayPrice*0.9)+"</td>";
					html += "<td class='priceNum priceTax'>"+(eList[i].tradingCount*eList[i].setDayPrice*0.1)+"</td>";
				}else{
					html += "<td>"+eList[i].goodsName+"</td>";
					html += "<td>"+eList[i].tradingCount +"</td>"
					html += "<td class='priceNum'>"+eList[i].rentalDayPrice*0.9+"</td>";
					html += "<td class='priceNum suppliedValue'>"+(eList[i].tradingCount*eList[i].rentalDayPrice*0.9)+"</td>";
					html += "<td class='priceNum priceTax'>"+(eList[i].tradingCount*eList[i].rentalDayPrice*0.1)+"</td>";
				}
				html+="<td><input class='note' type='text' value=''></td>";
				html+="</tr>"
			}
			html+="<tr class='sum-info'>\
					<td colspan='4' class='tableSmlTitle'>합계</td>\
					<td class='supplySum'></td>\
					<td class='taxSum'></td>\
					<td></td>	\
				</tr>\
			</table>"
		$('.content-table').append(html);
		if(i<10){
			for(j=i; j<10; j++){
				$('.sum-info').before("<tr><td></td><td></td><td></td><td></td><td></td><td></td>\
						<td><input class='note' type='text' value=''></td></tr>")
			}
		}
		
		var supplyPrice = 0;
		var priceTax = 0;
		$('.suppliedValue').each(function(){
			supplyPrice += Number($(this).text());
			$('.supplySum').text(supplyPrice);
		})
		$('.priceTax').each(function(){
			priceTax += Number($(this).text());
			$('.taxSum').text(priceTax);
		})
		var supplySum = Number($('.supplySum').text());
		var taxSum = Number($('.taxSum').text());
		$('#totalNum').text(numberFormat(supplySum+taxSum)) //총금액
		$('#totalKor').text(viewKorean(String(supplySum+taxSum))) //한글 총금액
		
		$('.supplySum').text(numberFormat(supplySum));
		$('.taxSum').text(numberFormat(taxSum));
		$('.priceNum').each(function(){
			if($(this).text()!=0){
				var priceNum = Math.floor($(this).text());
				priceNum = numberFormat(priceNum);
				$(this).text(priceNum);
			}else{
				$(this).text('');
			}
		})
		
		$('.btnPrint').click(function(){
			window.print();
		})
		
		function numberFormat(inputNumber) {
		   return inputNumber.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
		}
		function viewKorean(num) { 
			var hanA = new Array("","일","이","삼","사","오","육","칠","팔","구","십"); 
			var danA = new Array("","십","백","천","","십","백","천","","십","백","천","","십","백","천"); 
			var result = "";
			for(i=0; i<num.length; i++) { 
				str = ""; 
				han = hanA[num.charAt(num.length-(i+1))]; 
				if(han != "") str += han+danA[i]; 
				if(i == 4) str += "만"; 
				if(i == 8) str += "억"; 
				if(i == 12) str += "조"; 
				result = str + result; 
			} 
			return result ; 
		}
	})
</script>
</head>
<body>
    <div class="content-wrapper">
	  <div class="container">
		<h1><u>&emsp;견&emsp;적&emsp;서&emsp;</u></h1>
		<div style="float: left">
			<h3 th:text="'날짜 : '+${#dates.format(#dates.createNow(),'yyyy-MM-dd')}"></h3>
			<h3 th:if="${eList[0].customerCompanyName}!=null" th:text="${eList[0].customerCompanyName}+'고객님 귀하'"></h3>
			<h3 th:if="${eList[0].customerCompanyName}==null" th:text="${eList[0].customerName}+' 고객님 귀하'"></h3>
			<h3 th:text="'렌탈시작일 : ' +${eList[0].rentalFromDate}"></h3>
			<h3 th:text="'렌탈종료일 : ' +${eList[0].rentalToDate}"></h3>
			<h3>아래와 같이 견적합니다</h3>
		</div>
		<table class="company-info">
			<tr>
				<td rowspan="5" class="tableSmlTitle">공</br>급</br>자</td>
				<td class="tableSmlTitle">등록번호</td><td th:text="${mycompany.mycompanyNumber}"></td>
			</tr>
			<tr>
				<td class="tableSmlTitle">상호</td><td th:text="${mycompany.mycompanyName}"></td>
			</tr>
			<tr>
				<td class="tableSmlTitle">사업장 주소</td><td th:text="${mycompany.mycompanyAddr}"></td>
			</tr>
			<tr>
				<td class="tableSmlTitle">전화번호</td><td th:text="${mycompany.mycompanyTel}"></td>
			</tr>
			<!-- <tr>
				<td class="tableSmlTitle">팩스</td><td th:text="${mycompany.mycompanyFax}"></td>
			</tr> -->
		</table>
		<div class="content-table">
				
		</div>
<!-- 		<table style="margin-top: 20px; width: 700px;">
			<tr>
				<td class="tableSmlTitle" style="width: 10%">담당자</td>
				<td></td>
				<td class="tableSmlTitle" style="width: 10%">연락처</td>
				<td></td>
				<td class="tableSmlTitle" style="width: 15%">결제방법</td>
				<td></td>
			</tr>
		</table> -->
		<div style="text-align: center;">
			<button class="btnPrint" onclick="estimatePrint()" type="button">인쇄하기</button>
		</div>
	</div>
	    </div>
  </body>
</html>
