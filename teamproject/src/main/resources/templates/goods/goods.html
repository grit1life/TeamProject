<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>Insert title here</title>
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
      integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh"
      crossorigin="anonymous"
    />
    <!-- jquery cdn -->
    <script
      src="https://code.jquery.com/jquery-3.4.1.js"
      integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU="
      crossorigin="anonymous"
    ></script>
    <!-- axios cdn -->
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <!-- qs cdn -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qs/6.9.1/qs.min.js"></script>
  </head>
  <body>
    <section class="content">
      <div class="container-fluid">
        <div class="row">
          <div class="col-md-6">
            <button id="insert-form-btn" class="btn btn-primary">
              상품등록
            </button>
            <div class="card card-success">
              <div class="card-header">
                상품정보조회
              </div>
            </div>
            <div class="card-body">
              <table class="table">
                <thead>
                  <th>상품코드</th>
                  <th>상품카테고리</th>
                  <th>상품명</th>
                  <th>상세</th>
                </thead>
                <tbody id="list-tbody"></tbody>
              </table>
            </div>
          </div>

          <div class="col-md-6">
            <div id="form-div"></div>
          </div>
        </div>
        <div>
          <form id="file-upload-form">
            <label for="file-upload-input">Select file to upload</label>
            <input type="file" id="file-upload-input" name="file" />
            <button type="submit" id="#">파일등록</button>
          </form>
        </div>
      </div>
    </section>

    <script>
      axios
        .get("/goods")
        .then(res => {
          renderList(res.data);
        })
        .catch(err => {
          console.error(err);
        });

      const renderList = items => {
        items.forEach(item => {
          const listEl = document.createElement("tr");
          listEl.innerHTML =
            `<td>${item.goodsCode}</td>` +
            `<td>${item.goodsCategoryCode}</td>` +
            `<td>${item.goodsName}</td>` +
            `<td><button type="button" name=${item.goodsCode} class="view-btn btn btn-success" />상세</td>`;
          document.querySelector("tbody#list-tbody").appendChild(listEl);
        });
      };

      const renderForm = (formType, data) => {
        console.log(data.goodsCode);
        $("div#form-div").html("");
        const formEl = document.createElement("div");
        if (formType == "insert") {
          formEl.innerHTML = `
          <div class="card card-success">
            <div class="card-header">상품정보입력</div>
          </div>
          <form id="insert-form" role="form">
            <div class="card-body">

            <div class="form-group">
              <label>상품분류코드</label>
              <input name="goodsCategoryCode" class="form-control"/>
            </div>

            <div class="form-group">
              <label>상품명</label>
              <input name="goodsName" class="form-control"/>
            </div>
            
            <div class="form-group">
              <label>바코드</label>
            <input name="goodsBarcode" class="form-control"/>
            </div>

            <div class="form-group">
              <label>상품상세설명</label>
              <input name="goodsDesc" class="form-control"/>
            </div>

            <div class="form-group">
              <label>상품이미지</label>
              <input name="goodsImg" class="form-control"/>
            </div>

            <button type="button" id="insert-btn" class="btn btn-primary">등록</button>
            <button type="button" id="cancle-btn" class="btn btn-default">취소</button>
            
            </div>
          </form>`;
        } else if (formType == "view") {
          formEl.innerHTML = `
          <div class="card card-success">
            <div class="card-header">상품정보조회</div>
          </div>
          <form id="insert-form" role="form">
          <form id="view-form">
            <div class="card-body">
            
            <div class="form-group">
              <label>상품코드</label>
              <input name="goodsCode" value="${data.goodsCode}" class="form-control" readonly />
            </div>
            
            <div class="form-group">
              <label>상품분류코드</label>
              <input name="goodsCategoryCode" value="${data.goodsCategoryCode}" class="form-control" readonly />
            </div>

            <div class="form-group">
              <label>상품분류명</label>
              <input name="goodsCategoryCode" value="${data.goodsCategoryCode}" class="form-control" readonly />
            </div>

            <div class="form-group">
              <label>상품명</label>
              <input name="goodsName" value="${data.goodsName}" class="form-control" readonly />
            </div>

            <div class="form-group">
              <label>바코드</label>
              <input name="goodsBarcode" value="${data.goodsBarcode}" class="form-control" readonly />
            </div>

            <div class="form-group">
              <label>등록직원</label>
              <input name="goodsInputStaffCode" value="${data.goodsInputStaffCode}" class="form-control" readonly />
            </div>

            <div class="form-group">
              <label>등록일</label>
              <input name="goodsInputDate" value="${data.goodsInputDate}" class="form-control" readonly/>
            </div>

            <div class="form-group">
              <label>수정직원</label>
              <input name="goodsUpdateStaffCode" value="${data.goodsUpdateStaffCode}" class="form-control" readonly />
            </div>

            <div class="form-group">
              <label>수정일</label>
              <input name="goodsUpdateDate" value="${data.goodsUpdateDate}" class="form-control" readonly />
            </div>

            <div class="form-group">
              <label>상품상세설명</label>
              <input name="goodsDesc" value="${data.goodsDesc}" class="form-control" readonly />
            </div>

            <div class="form-group">
              <label>상품이미지</label>
              <input name="goodsImg" value="${data.goodsImg}" class="form-control" readonly />
            </div>

            <button type="button" name=${data.goodsCode} id="update-form-btn" class="btn btn-warning">수정</button>
            <button type="button" id="delete-btn" class="btn btn-danger">삭제</button>
            <button type="button" id="cancle-btn" class="btn btn-default">취소</button>

            </div>
          </form>`;
        } else if (formType == "update") {
          formEl.innerHTML = `<form id="update-form">
          <input name="goodsCode" value="${data.goodsCode}" readonly />
          <input name="goodsCategoryCode" value="${data.goodsCategoryCode}" />
          <input name="goodsName" value="${data.goodsName}" />
          <input name="goodsBarcode" value="${data.goodsBarcode}" />
          <input name="goodsInputStaffCode" value="${data.goodsInputStaffCode}" readonly/>
          <input name="goodsInputDate" value="${data.goodsInputDate}" readonly/>
          <input name="goodsDesc" value="${data.goodsDesc}" />
          <input name="goodsImg" value="${data.goodsImg}" />
          <button type="button" id="update-btn" class="btn btn-warning">수정</button>
          <button type="button" id="cancle-btn" class="btn btn-default">취소</button>
          </form>`;
        }
        $("div#form-div").append(formEl);
      };

      $(document).on("click", ".view-btn", e => {
        const goodsCode = e.target.name;
        axios
          .get(`/goods/${goodsCode}`)
          .then(res => {
            renderForm("view", res.data);
          })
          .catch(err => {
            console.error(err);
          });
      });

      $(document).on("click", "button#insert-form-btn", e => {
        const data = {};
        renderForm("insert", data);
      });

      $(document).on("click", "button#insert-btn", e => {
        $.ajax({
          type: "post",
          url: "/goods",
          data: $("form#insert-form").serialize(),
          contentType: "application/x-www-form-urlencoded; charset=euc-kr",
          success: msg => {
            console.log(msg);
            const data = {};
            renderForm("insert", data);
          }
        });
      });

      $(document).on("click", "button#update-form-btn", e => {
        const goodsCode = e.target.name;
        axios
          .get(`/goods/${goodsCode}`)
          .then(res => {
            renderForm("update", res.data);
          })
          .catch(err => {
            console.error(err);
          });
      });
    </script>
  </body>
</html>
