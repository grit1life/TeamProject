<!DOCTYPE html>
<html
  xmlns:th="http://www.thymeleaf.org"
  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
  layout:decorate="~{layout/default}"
>
<th:block layout:fragment="customTitle">
	<title>직원 목록</title>
</th:block>


<body class="hold-transition sidebar-mini layout-fixed">
<th:block layout:fragment="customContents">
 <div class="content-wrapper">
    <section class="content-header">
      <div class="container-fluid">
        <div class="row mb-2">
          <div class="col-sm-6">
            <h1>직원 목록</h1>
          </div>
          <div class="col-sm-6">
            <ol class="breadcrumb float-sm-right">
              <li class="breadcrumb-item"><a href="#">Home</a></li>
              <li class="breadcrumb-item active">Advanced Form</li>
            </ol>
          </div>
        </div>
      </div><!-- /.container-fluid -->
    </section>
  
  <section class="content">
  	<div class="container-fluid">
	 <div class="card card-default">
	 <div class="card-header">
	   <h3 class="card-title">직원 검색</h3>
	
	   <div class="card-tools">
	     <button type="button" class="btn btn-tool" data-card-widget="collapse"><i class="fas fa-minus"></i></button>
	     <button type="button" class="btn btn-tool" data-card-widget="remove"><i class="fas fa-remove"></i></button>
	   </div>
	 </div>
	 
	 <div class="card-body">
         <!-- left -->
         <form id="staffSerch">
         <div class="row" >
           <!-- 1 -->
           <div class="col-md-6" style="max-width: 20%;">
             <div class="form-group">
               <label>지점</label>
	          <select class="form-control select2bs4" style="width: 100%;" name="branchCode">
	            <option selected="selected"></option>
	            <th:block th:each="B:${branchSerectList}">
	            	<option th:value="${B.branchCode}" th:text="${B.branchName}">본사</option>
	       		</th:block>
	          </select>
             </div>
             <!-- /.form-group -->
             <div class="form-group">
               <label>직책</label>
          	   <input type="text" class="form-control select2bs4" style="width: 100%;" name="staffPosition">
             </div>
             <!-- /.form-group -->
           </div>
           <!-- 2 -->
           <div class="col-md-6" style="max-width: 20%;">
             <div class="form-group">
               <label>권한</label>
          <select class="form-control select2bs4" style="width: 100%;" name="staffLevel">
            <option selected="selected"></option>
            <option value="관리자">관리자</option>
            <option value="직원">직원</option>
          </select>
             </div>
             <!-- /.form-group -->
             <div class="form-group">
               <label>이름</label>
          <input type="text" class="form-control select2bs4" name="staffName">
          </div>
             <!-- /.form-group -->
           </div>
           
           <!-- 3 -->
           <div class="col-md-6" style="max-width: 25%;">
             <div class="form-group">
               <label>생년월일</label>
	         	<input type="date" class="form-control select2bs4" name="staffBirth">
	         </div>
             <!-- /.form-group -->
             <div class="form-group">
               <label>전화번호</label>
	         	<input type="text" class="form-control select2bs4" name="staffTell">
	         </div>
             <!-- /.form-group -->
           </div>
           <!-- 4 -->
           <div class="col-md-6" style="max-width: 35%;">
             <div class="form-group">
               <label>이메일</label>
               <input type="email" class="form-control select2bs4" name="staffEmail">
             </div>
             <!-- /.form-group -->
             <div class="form-group" style="position: absolute;bottom: 0;">
               <button id="staffSerchBtn" type="button" class="btn btn-info">검색</button>
             </div>
             <!-- /.form-group -->
           </div>

           <!-- /.col -->
        
         </div>
         </form>
            <!-- /.row -->
      </div>
	 </div>
	
	<div class="card">
	 <div class="card-body" style="margin-top:20px">
	  	<table id="example2" class="table table-bordered table-hover">
	    	<thead id=staffListThead>
                <tr>
                  <th>지점</th>
                  <th>직책</th>
                  <th>직원 명</th>
                  <th>생년월일</th>
                  <th>전화번호</th>
                  <th>이메일</th>
                  <th>권한</th>
                  <th>상세/수정</th>
                </tr>
	         </thead>
             <tbody id="staffList">
              <tr th:each="L:${staffList}">
                <td th:text="${L.branchName}"></td>
                <td th:text="${L.staffPosition}"></td>
                <td th:text="${L.staffName}"></td>
                <td th:text="${L.staffBirth}"></td>
                <td th:text="${L.staffTell}"></td>
                <td th:text="${L.staffEmail}"></td>
                <td th:text="${L.staffLevel}"></td>
              	<td style="text-align: center;vertical-align: middle;">
               		<a th:href="'/admin/staffList?staffCode='+${L.staffCode}" class="btn btn-sm btn-info" style="padding:1px 4px 1px 4px;">
               			<i class="fas fa-folder"></i>&ensp;상세/수정
               		</a>
              	</td>
              </tr>
             </tbody>
		</table>
	  </div>
	  <!-- /.card-body -->
	 </div>
     <!-- /.card --> 	
    </div>
    
  </section>
  
 <script type="text/javascript">
	$(function(){
		$('#staffSerchBtn').click(function(){	
				  const formData = new FormData($("form#staffSerch")[0]);

				 $.ajax({
				    type: "post",
				    url: "/staff/staffList",
				    processData: false,
				    contentType: false,
				    data: formData,
				    error: err => {
				      renderMsgModal(
				        "오류 메시지",
				        "서버 에러가 발생했습니다. 관리자에게 문의 바랍니다."
				      );
				      console.log(err);
				    },
				    success: data => {
				    	$('#staffList').remove();
				    	console.log(data);
				    	console.log(data[0].staffName);
				    	
				    	var staffHtml = '<tbody id="staffList">'
				    		
				    	for(var i=0; i<data.length; i++){
				    		staffHtml += '<tr>'
				    		staffHtml += '<td>'+data[i].branchName+'</td>'
				    		if(data[i].staffPosition!=null){
				    			staffHtml += '<td>'+data[i].staffPosition+'</td>'
				    		}else{
				    			staffHtml += '<td></td>'
				    		}
				    		staffHtml += '<td>'+data[i].staffName+'</td>'
				    		staffHtml += '<td>'+data[i].staffBirth+'</td>'
				    		staffHtml += '<td>'+data[i].staffTell+'</td>'
				    		staffHtml += '<td>'+data[i].staffEmail+'</td>'
				    		staffHtml += '<td>'+data[i].staffLevel+'</td>'
				    		staffHtml += '</tr>'
				    	}
				    		staffHtml += '</tbody>'
				    		console.log(staffHtml);
				    		$('#staffListThead').after(staffHtml);
				    }
				  });
				

		})
	})
</script>	
  </div>
 </th:block>
</body>
</html>